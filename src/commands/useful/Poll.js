const {MessageEmbed}  = require('discord.js');
const config          = require('../../../config.json');
const errors          = require('../../lib/errors.js');

//  –ü–æ—á–µ–º—É —è –≤—Å—ë —ç—Ç–æ —Ä–µ—à–∏–ª –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å? –ù–µ –∑–Ω–∞—é... –ù–æ —Ö—É–∂–µ –æ—Ç —ç—Ç–æ–≥–æ –Ω–µ —Å—Ç–∞–ª–æ)
module.exports = {
    "run": async (message, bot, args) => {
        message.delete(); //  –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        
        let text   = args.join(" "); //  –°–æ–µ–¥–∏–Ω—è–µ–º –≤—Å—ë –≤ –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç
        let embed  = new MessageEmbed() //  –î–µ–ª–∞–µ–º –≤—Å—ë —ç—Ç–æ —Å–µ–π—á–∞—Å, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—ë —ç—Ç–æ –ø–æ—Ç–æ–º
        .setColor(config.colors.default)
        .setFooter(message.author.username, message.author.avatarURL({ dynamic: true }) || message.author.defaultAvatarURL)

        if(!text.trim()) return message.channel.send(embed.setTitle('?')) //  –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç–∞ –∫–∞–∫ —Ç–∞–∫–æ–≤–æ–≥–æ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏–º ? –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º
        .then(async msg=> { await msg.react('‚úÖ'); msg.react('‚ùé'); }) //  –°—Ç–∞–≤–∏–º —Ä–µ–∞–∫—Ü–∏–∏

        let matchedText = text.match(/"(\\.|[^"\\])*"/g) //  –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∫–∞–≤—ã—á–∫–∞—Ö

        if(!matchedText) { //  –ï—Å–ª–∏ –∫–∞–≤—ã—á–µ–∫ –Ω–µ—Ç
            if(text.length>=256) return errors.falseArgs(message,"–¢–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 256 —Å–∏–º–≤–æ–ª–æ–≤!"); //  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ discord.js
            
            return message.channel.send(embed.setTitle(text)) //  –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π embed
            .then(async msg=> { await msg.react('‚úÖ'); msg.react('‚ùé'); }); //  –°—Ç–∞–≤–∏–º —Ä–µ–∞–∫—Ü–∏–∏
        }

        for(let i = 0; i<=matchedText.length-1; i++) matchedText[i] = matchedText[i].slice(1, -1); //  –ò–∑–±–∞–≤–ª—è–µ–º—Å—è –æ—Ç –∫–∞–≤—ã—á–µ–∫ –ø–æ –∫—Ä–∞—è–º —É –∫–∞–∂–¥–æ–≥–æ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

        if(matchedText.length == 1) { //  –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–º–∞ (–∫–∞–∑–∞–ª–æ—Å—å –±—ã,–∞ –Ω–∞ —Ö—Ä–µ–Ω–∞ —Ç–æ–≥–¥–∞ –∫–∞–≤—ã—á–∫–∏)

            if(!matchedText[0].trim()) embed.setTitle('?') //  –ï—Å–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ (–µ—â—ë –ª—É—á—à–µ), –∑–∞–ø–∏—Å—ã–≤–∞–µ–º ?
            else if(matchedText[0].length>=256) return errors.falseArgs(message,"–¢–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 256 —Å–∏–º–≤–æ–ª–æ–≤!"); //  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ discord.js
            else embed.setTitle(matchedText[0]) //  –ï—Å–ª–∏ –∂–µ –≤—Å—ë —Ç–∞–∫–∏ —Ç–∞–º —á—Ç–æ-—Ç–æ –µ—Å—Ç—å, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ç–∞–π—Ç–ª

            return message.channel.send(embed) //  –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
            .then(async msg=> { await msg.react('‚úÖ'); msg.react('‚ùé'); }); //  –°—Ç–∞–≤–∏–º —Ä–µ–∞–∫—Ü–∏–∏
        
        } else {
            if(matchedText[0].trim().length>=256) return errors.falseArgs(message,"–¢–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 256 —Å–∏–º–≤–æ–ª–æ–≤!"); //  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ discord.js
            if(matchedText[0].trim()) embed.setTitle(matchedText[0]) //  –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Ç–∞–º –≤—Å—ë —Ç–∞–∫–∏ –µ—Å—Ç—å

            let variables  = matchedText.slice(1) //  –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            let endText    = ""; //  –ö–æ–Ω–µ—á–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞—Å—É–Ω—É—Ç—å –≤ setDescription
            let l  = 0, i  = 0; //  –Ø –ø—Ä–æ—Å—Ç–æ –≥–µ–Ω–∏–π... –ù–æ –∑–∞—á–µ–º?

            for(;i<=variables.length-1;i++) { 
                if(!variables[i].trim()) { //  –ï—Å–ª–∏ —Ç–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ—Ç, —Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    l++;
                    continue;
                } else endText+= `${i+1-l}. ${variables[i]}\n`; //  –ï—Å–ª–∏ —Ç–∞–º —á—Ç–æ-—Ç–æ –µ—Å—Ç—å , —Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º. –¢–∞–º —É–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
            }

            if((i-l)>10) return errors.falseArgs(message,"–ù–µ –±–æ–ª—å—à–µ 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤!"); //  –†–µ–∞–∫—Ü–∏–π –≤—Å–µ–≥–æ –ª–∏—à—å 10...
            
            else if(!endText.trim()) return message.channel.send(embed) //  –ï—Å–ª–∏ –≤ –∏—Ç–æ–≥–µ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –ø—É—Å—Ç—ã–º–∏ (–ø–æ—á–µ–º—É)
            .then(async msg=> { await msg.react('‚úÖ'); msg.react('‚ùé'); }); //  –°–º—ã—Å–ª —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –Ω–µ –ø–æ–º–µ–Ω—è–ª—Å—è

            else embed.setDescription(endText); //  –ê –µ—Å–ª–∏ —Ç–∞–º —á—Ç–æ-—Ç–æ –µ—Å—Ç—å, —Ç–æ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –æ–ø–∏—Å–∞–Ω–∏–µ
            
            message.channel.send(embed) //  –û—Ç–ø—Ä–∞–≤–ª—è–µ–º
            .then(async msg=> { //  –¢—É—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–π –ø–æ —Å–ª–æ–∂–Ω–µ–µ –±—É–¥–µ—Ç
                for(let i2 = 1; i2<(i+1-l); i2++) await msg.react(["1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£","4Ô∏è‚É£","5Ô∏è‚É£","6Ô∏è‚É£","7Ô∏è‚É£","8Ô∏è‚É£","9Ô∏è‚É£","üîü"][i2-1]);
            });
        }
    },
    "aliases": ["poll"],
    "help": {
        "category": "–ü–æ–ª–µ–∑–Ω–æ–µ",
        "description": "–°–æ–∑–¥–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π",
        "arguments": `**<—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è || "?">** - –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º–æ–π (–∏–Ω–∞—á–µ —Ç–µ–º–∞ –±—É–¥–µ—Ç "?")\n**"<—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è || "?">" "<–≤—ã–±–æ—Ä 1>" "<–≤—ã–±–æ—Ä 2>" ... "<–≤—ã–±–æ—Ä 10>"** - –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏`,
        "usage": `**${config.prefix}poll** - –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å —Ç–µ–º–æ–π "?"\n**${config.prefix}poll –ü–æ–π—Ç–∏ –∫—É—à–∞—Ç—å?** -  –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å —Ç–µ–º–æ–π "–ü–æ–π—Ç–∏ –∫—É—à–∞—Ç—å?"\n**${config.prefix}poll "–ß—Ç–æ –ø–æ–∫—É—à–∞—Ç—å?" "–Ø–∏—á–Ω–∏—Ü–∞" "–û–º–ª–µ—Ç" "–û–º–ª–µ—Ç —Å —Å–æ—Å–∏—Å–∫–∞–º–∏"** - –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å —Ç–µ–º–æ–π "–ß—Ç–æ –ø–æ–∫—É—à–∞—Ç—å?" –∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ "–Ø–∏—á–Ω–∏—Ü–∞", "–û–º–ª–µ—Ç", "–û–º–ª–µ—Ç —Å —Å–æ—Å–∏—Å–∫–∞–º–∏"\n**${config.prefix}poll "" "–î–∞" "–ù–µ—Ç" "–ù–µ –∑–Ω–∞—é"** - –°–æ–∑–¥–∞—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ç–µ–º—ã —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ "–î–∞" "–ù–µ—Ç" –∏ "–ù–µ –∑–Ω–∞—é"`,
    },
    "botPermissions": ["ADD_REACTIONS"],
    "userPermissions": []
}